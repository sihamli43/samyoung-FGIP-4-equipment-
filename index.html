<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SAMYOUNG FGIP -4 Equipment Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    * { box-sizing: border-box; font-family: system-ui, sans-serif; }

    body {
      margin: 0;
      background: #F5F6FA;
      color: #0A0E2A;
    }

    /* Login Page */
    #loginScreen {
      position: fixed;
      inset: 0;
      background: #F3F4F6;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    #loginScreen .box {
      background: white;
      padding: 24px;
      width: 300px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    #loginScreen input {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    .btn {
      padding: 10px 18px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-weight: 600;
    }

    .btn-primary {
      background: #D62828;
      color: white;
    }

    .btn-ghost {
      background: transparent;
      color: #D62828;
      border: 1px solid #D62828;
    }

    /* Main Layout */
    .app {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    header h1 {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 0;
      font-size: 1.8rem;
      color: #0A0E2A;
    }

    header img {
      height: 55px;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      margin-bottom: 20px;
    }

    .stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .stat-card {
      background: #EFF2FF;
      padding: 16px;
      border-radius: 10px;
    }

    .layout {
      display: grid;
      grid-template-columns: 1.5fr 1fr;
      gap: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 8px;
      border-bottom: 1px solid #ddd;
      text-align: left;
    }

    tr:hover {
      background: #F2F6FF;
      cursor: pointer;
    }

    .thumb {
      width: 40px;
      height: 40px;
      border-radius: 6px;
      object-fit: cover;
    }

    input {
      padding: 8px;
      width: 100%;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin-bottom: 10px;
    }

    .vehicle-image {
      width: 100%;
      height: 220px;
      object-fit: cover;
      background: #EEE;
      border-radius: 10px;
    }

    .detail-grid {
      display: grid;
      grid-template-columns: repeat(2,1fr);
      gap: 8px;
    }
  </style>
</head>

<body>

<!-- LOGIN -->
<div id="loginScreen">
  <div class="box">
    <h2 style="text-align:center; margin-top:0;">Login</h2>

    <label>Username</label>
    <input id="loginUser">

    <label>Password</label>
    <input id="loginPass" type="password">

    <button id="loginBtn" class="btn btn-primary" style="width:100%;">Login</button>

    <p id="loginError" style="color:red; text-align:center; display:none;">Invalid login</p>
  </div>
</div>

<!-- MAIN APP -->
<div class="app" id="mainApp" style="display:none;">

  <header>
    <h1><img src="assets/logo.png" alt="Logo">SAMYOUNG FGIP -4</h1>
    <span style="opacity:0.7;">Using Online Database (Firestore)</span>
  </header>

  <div class="layout">
    <!-- LEFT SIDE -->
    <div>
      <div class="card">
        <h3>Vehicle List</h3>
        <table>
          <thead>
            <tr>
              <th>Photo</th>
              <th>Driver Name</th>
              <th>Vehicle / Equipment</th>
              <th>Plate</th>
              <th>Next Service</th>
            </tr>
          </thead>
          <tbody id="vehicleTableBody"></tbody>
        </table>
      </div>

      <div class="card">
        <h3>Add New Vehicle</h3>

        <form id="vehicleForm">
          <label>Driver Name *</label>
          <input id="driverName" required>

          <label>Plate *</label>
          <input id="plate" required>

          <label>Vehicle / Equipment</label>
          <input id="driver">

          <label>Iqama</label>
          <input id="iqama">

          <label>License</label>
          <input id="license">

          <label>Inspection Date</label>
          <input id="inspectionDate" type="date">

          <label>Inspection Expiry</label>
          <input id="expiryDate" type="date">

          <label>Medical Fitness Expiry</label>
          <input id="medicalExpiryDate" type="date">

          <label>Last Service Date</label>
          <input id="serviceDate" type="date">

          <label>Next Service Date</label>
          <input id="nextServiceDate" type="date">

          <label>Photo</label>
          <input id="image" type="file" accept="image/*">

          <label>Documents</label>
          <input id="docs" type="file" multiple>

          <button class="btn btn-primary" style="margin-top:10px;">Add Vehicle</button>
        </form>
      </div>
    </div>

    <!-- RIGHT SIDE -->
    <div>
      <div class="card" id="detailsCard">
        <h3 id="detailsTitle">No vehicle selected</h3>
        <p id="detailsSubtitle">Select a vehicle to view details</p>

        <button class="btn btn-ghost" onclick="deleteVehicle()">Delete</button>
        <button class="btn btn-primary" onclick="window.print()">Print</button>

        <div id="detailsBody" style="margin-top:10px; display:none;">

          <img id="detailsImage" class="vehicle-image">

          <div class="detail-grid">

            <div><strong>Vehicle / Equipment:</strong> <span id="detailsDriver"></span></div>
            <div><strong>Driver Name:</strong> <span id="detailsTitle"></span></div>

            <div><strong>Plate:</strong> <span id="detailsPlate"></span></div>
            <div><strong>Iqama:</strong> <span id="detailsIqama"></span></div>

            <div><strong>License:</strong> <span id="detailsLicense"></span></div>
            <div><strong>Inspection:</strong> <span id="detailsInspection"></span></div>

            <div><strong>Inspection Expiry:</strong> <span id="detailsExpiry"></span></div>
            <div><strong>Medical Fitness Expiry:</strong> <span id="detailsMedicalExpiry"></span></div>

            <div><strong>Last Service:</strong> <span id="detailsService"></span></div>
            <div><strong>Next Service:</strong> <span id="detailsNextService"></span></div>

          </div>

          <h4>Documents</h4>
          <ul id="detailsDocs"></ul>

        </div>
      </div>
    </div>
  </div>
</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc }
  from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAwAMnqkJz9uifaaKETPTyFkIzhPfjQfEs",
  authDomain: "samyoung-equipment.firebaseapp.com",
  projectId: "samyoung-equipment",
  storageBucket: "samyoung-equipment.firebasestorage.app",
  messagingSenderId: "1085341907778",
  appId: "1:1085341907778:web:0d7172ab61bcfbaf52a6db",
  measurementId: "G-DZ095FKLSS"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const vehiclesCol = collection(db, "vehicles");

async function dbLoadVehicles() {
  const snap = await getDocs(vehiclesCol);
  return snap.docs.map(d => ({ id: d.id, ...d.data() }));
}

async function dbAddVehicle(data) {
  const ref = await addDoc(vehiclesCol, data);
  return { ...data, id: ref.id };
}

async function dbDeleteVehicle(id) {
  await deleteDoc(doc(vehiclesCol, id));
}

window.dbApi = { dbLoadVehicles, dbAddVehicle, dbDeleteVehicle };
</script>

<!-- MAIN LOGIC -->
<script>
let vehicles = [];
let currentVehicleId = null;

/* LOGIN */
document.getElementById("loginBtn").onclick = function () {
  if (loginUser.value === "samyoung" && loginPass.value === "FGIP-4") {
    loginScreen.style.display = "none";
    mainApp.style.display = "block";
  } else {
    loginError.style.display = "block";
  }
};

/* LOAD VEHICLES */
document.addEventListener("DOMContentLoaded", () => {
  window.dbApi.dbLoadVehicles().then(list => {
    vehicles = list;
    renderList();
  });
});

/* RENDER TABLE */
function renderList() {
  vehicleTableBody.innerHTML = "";

  vehicles.forEach(v => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${v.imageDataUrl ? `<img class="thumb" src="${v.imageDataUrl}">` : "—"}</td>
      <td>${v.name}</td>
      <td>${v.driver || "—"}</td>
      <td>${v.plate}</td>
      <td>${v.nextServiceDate || "—"}</td>
    `;
    tr.onclick = () => showDetails(v.id);
    vehicleTableBody.appendChild(tr);
  });
}

/* SHOW DETAILS */
function showDetails(id) {
  const v = vehicles.find(x => x.id === id);

  detailsTitle.textContent = v.name;
  detailsDriver.textContent = v.driver;
  detailsPlate.textContent = v.plate;

  detailsIqama.textContent = v.iqama || "—";
  detailsLicense.textContent = v.license || "—";

  detailsInspection.textContent = v.inspectionDate || "—";
  detailsExpiry.textContent = v.expiryDate || "—";
  detailsMedicalExpiry.textContent = v.medicalExpiryDate || "—";

  detailsService.textContent = v.serviceDate || "—";
  detailsNextService.textContent = v.nextServiceDate || "—";

  detailsImage.src = v.imageDataUrl || "";

  detailsDocs.innerHTML = "";
  if (v.docs?.length) {
    v.docs.forEach(d => {
      const li = document.createElement("li");
      li.innerHTML = `<a href="${d.dataUrl}" target="_blank">${d.name}</a>`;
      detailsDocs.appendChild(li);
    });
  }

  detailsBody.style.display = "block";
}

/* DELETE VEHICLE */
function deleteVehicle() {
  if (!currentVehicleId) return;
  window.dbApi.dbDeleteVehicle(currentVehicleId).then(() => {
    vehicles = vehicles.filter(v => v.id !== currentVehicleId);
    renderList();
    detailsBody.style.display = "none";
    detailsTitle.textContent = "No vehicle selected";
  });
}

/* ADD VEHICLE */
vehicleForm.onsubmit = function(e) {
  e.preventDefault();

  const data = {
    name: driverName.value,
    plate: plate.value,
    driver: driver.value,
    iqama: iqama.value,
    license: license.value,
    inspectionDate: inspectionDate.value,
    expiryDate: expiryDate.value,
    medicalExpiryDate: medicalExpiryDate.value,
    serviceDate: serviceDate.value,
    nextServiceDate: nextServiceDate.value,
    imageDataUrl: null,
    docs: []
  };

  const img = image.files[0];
  const docFiles = docs.files;

  function saveFinal() {
    window.dbApi.dbAddVehicle(data).then(saved => {
      vehicles.push(saved);
      renderList();
      showDetails(saved.id);
    });
    vehicleForm.reset();
  }

  function readDocs(done) {
    let out = [];
    if (!docFiles.length) return done(out);

    let remaining = docFiles.length;
    for (const file of docFiles) {
      const r = new FileReader();
      r.onload = () => {
        out.push({ name: file.name, dataUrl: r.result });
        if (--remaining === 0) done(out);
      };
      r.readAsDataURL(file);
    }
  }

  function readImage(next) {
    if (!img) return next(null);

    const reader = new FileReader();
    reader.onload = () => next(reader.result);
    reader.readAsDataURL(img);
  }

  readImage(imgUrl => {
    data.imageDataUrl = imgUrl;

    readDocs(docArr => {
      data.docs = docArr;
      saveFinal();
    });
  });

};
</script>

</body>
</html>






